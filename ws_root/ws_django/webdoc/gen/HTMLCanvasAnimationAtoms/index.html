<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang="en">

<head>
    <title>Atoms!</title>
    <style type="text/css">
        canvas {
            border: 1px solid black;
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
            width: 70%;
        }
    </style>
</head>

<body onload="main();">
    <script type="text/javascript">
globalSpeedFudge = 0.00001;

function getRandomColor() {
    var letters = '0123456789ABCDEF'.split('');
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

var Planet = function(x, y, mass){
    this.x = x;
    this.y = y;
    this.dx = 0;
    this.dy = 0;
    if(0){
        this.dx = (0.05/globalSpeedFudge)*(50 - Math.random()*100);
        this.dy = (0.05/globalSpeedFudge)*(50 - Math.random()*100);
    }
    this.mass = mass;
    this.color = getRandomColor();
    this.colorEdge = getRandomColor();
    this.trail = [];
};

Planet.prototype.draw = function(){
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.mass*0.1, 0, 2 * Math.PI, false);
    ctx.fillStyle = this.color;
    ctx.fill();
    ctx.lineWidth = 2;
    ctx.strokeStyle = this.colorEdge; 
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(this.x, this.y);
    for(var i = this.trail.length-1; i >= 0; --i){
        var p = this.trail[i];
        ctx.lineTo(p.x, p.y);
    }
    ctx.lineWidth = this.mass/20;
    ctx.lineCap = 'round';
    ctx.globalAlpha = 0.4;
    ctx.stroke();

    ctx.globalAlpha = 1.0;
};

createWorldObjects = function(world){
    for(var i = 0; i < 100; ++i){
        var planet = new Planet(world.dx * Math.random(), world.dy * Math.random(), 400 * Math.random() * Math.random());
        world.objects.push(planet);
    }
};

var dist = function(o1, o2){
    return Math.sqrt( (o1.x - o2.x)*(o1.x - o2.x) + (o1.y - o2.y)*(o1.y - o2.y) );
};

var direction = function(o1, o2){
    var v = new Object();
    v.x = o2.x-o1.x;
    v.y = o2.y-o1.y;

    magn = Math.sqrt( v.x*v.x + v.y*v.y );
    v.x = v.x/magn;
    v.y = v.y/magn;
    return v;
};

gravity = function(world){
    for(var i =0; i < world.objects.length; ++i){
        for(var j =0; j < world.objects.length; ++j){

            if(i != j){
                var o1 = world.objects[j];
                var o2 = world.objects[i];
                var d = dist(o1, o2);

                if(d > 1){
                    var v = direction(o1, o2);
                    var attr = o2.mass / d*d; 
                    o1.dx += v.x*attr;
                    o1.dy += v.y*attr;
                }
            }
        }
    }
};

movement = function(world){
    for(var i =0; i < world.objects.length; ++i){
        var o = world.objects[i];

        var pos = new Object();
        pos.x = o.x;
        pos.y = o.y;
        o.trail.push(pos);

        if(o.trail.length > 50){
            o.trail.shift();
        }

        o.x += o.dx * globalSpeedFudge;
        o.y += o.dy * globalSpeedFudge;
    }
};

updateLogic = function(world){
   gravity(world); 
   movement(world); 
};

drawLogic = function(world){
    for(var i =0; i < world.objects.length; ++i){
        world.objects[i].draw();
    };
};

</script>
<script type="text/javascript">
window.requestAnimFrame =
    window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.oRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function (callback) {
        window.setTimeout(callback, 1000 / 60);
};

// Global variables accessible everywhere.
var canvas, world;

var World = function () {
    this.objects = []
};

World.prototype.update = function () {
    updateLogic(world);
};

World.prototype.draw = function () {
    drawLogic(world);
};

function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    world.update();
    world.draw();
    requestAnimFrame(update);
}

function start() {
    world = new World();
    world.dx = canvas.width;
    world.dy = canvas.height;
    createWorldObjects(world);
    update();
}

window.onload = function () {
    canvas = document.getElementById('canvas_main');
    ctx = canvas.getContext('2d');
    canvas.width = 800;
    canvas.height = 600;
    start();
};

</script>

    <h1> HTML5 Canvas Atoms! </h1>
    <canvas id="canvas_main"></canvas>

    <h1>anim.js to Create Simple Interactive Canvas Elements</h1>
<p>This is a simple demo on how to do animations using HTML5 canvas. You can just steal the bare-bone anim.sj which will take care to animate everything as long as you provide the following three JavaScript functions:</p>
<p>createWorldObjects(world)
drawLogic(world)
updateLogic(world)</p>
<p>If you look in atom.js (<a href="https://github.com/grokit/website_grokit_ca/blob/master/articles/web/HTMLCanvasAnimationAtoms">you can check all the most up to dates file on git-hub here</a>), you see that this is pretty simple:</p>
<pre><code>createWorldObjects = function(world){
  for(var i = 0; i &lt; 100; ++i){
    var planet = new Planet(world.dx * Math.random(), world.dy * Math.random(), 400 * Math.random() * Math.random());
    world.objects.push(planet);
  }
};

updateLogic = function(world){
  gravity(world);
  movement(world);
};

drawLogic = function(world){
  for(var i =0; i &lt; world.objects.length; ++i){
    world.objects[i].draw();
  };
};
</code></pre>
<p>The only thing to remember is to make sure all the objects that you add to the world have a draw() function.</p>
<p>To play around with this, you can just save this page as an .html file, edit it and run it in your browser. That .js is embedded in the html so you do not need a server to play with it.</p>
<h1>atom.js How Does It Work</h1>
<p>You can inspect the code, but the gist of it is just the gravity function which pulls the object proportional to distance and mass:</p>
<pre><code>gravity = function(world){
  for(var i =0; i &lt; world.objects.length; ++i){
    for(var j =0; j &lt; world.objects.length; ++j){

      if(i != j){
        var o1 = world.objects[j];
        var o2 = world.objects[i];
        var d = dist(o1, o2);

        if(d &gt; 1){
          var v = direction(o1, o2);
          var attr = o2.mass / d*d;
          o1.dx += v.x*attr;
          o1.dy += v.y*attr;
        }
      }
    }
  }
};
</code></pre>
<p>The only thing left to do is to draw the circles proportional to their mass.</p>

</body>

</html>
